growth_1990_2015 =
ifelse(is.finite(sum(abs_growth, na.rm = TRUE) /
first(mtoe)),
sum(abs_growth, na.rm = TRUE) / first(mtoe),
NA),
mtoe_1990 = first))
saveRDS(yearly_energy_summary,
"./data/processed/yearly_energy_summary.rds")
saveRDS(country_energy_summary,
"./data/processed/country_energy_summary.rds")
country_energy_summary <-
primary_energy_enriched %>%
group_by(country, energy_source) %>%
summarise_at(vars(contains("mtoe")),
funs(abs_growth = sum(abs_growth, na.rm = TRUE),
growth_1990_2015 =
ifelse(is.finite(sum(abs_growth, na.rm = TRUE) /
first(mtoe)),
sum(abs_growth, na.rm = TRUE) / first(mtoe),
NA),
mtoe_1990 = first,
mtoe_2015 = last))
saveRDS(country_energy_summary,
"./data/processed/country_energy_summary.rds")
plot_yearly_summary <- function(country_summary, plot_var){
country_summary %>%
ggplot(aes_(~country, as.name(plot_var), colour = ~energy_source,
group = ~energy_source)) +
geom_line(size = 1) +
blorg::blog_theme +
scale_color_manual(values = blorg::blog_palette)
}
plot_yearly_summary <- function(yearly_summary, plot_var){
yearly_summary %>%
ggplot(aes_(~year, as.name(plot_var), colour = ~energy_source,
group = ~energy_source)) +
geom_line(size = 1) +
blorg::blog_theme +
scale_color_manual(values = blorg::blog_palette)
}
plot_country_summary <- function(country_summary, plot_var){
country_summary %>%
ggplot(aes_(~country, as.name(plot_var), colour = ~energy_source,
group = ~energy_source)) +
geom_line(size = 1) +
blorg::blog_theme +
scale_color_manual(values = blorg::blog_palette)
}
plot_country_summary <- function(country_summary, plot_var){
country_summary %>%
ggplot(aes_(~country, as.name(plot_var), colour = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_color_manual(values = blorg::blog_palette)
}
plot_country_summary(country_energy_summary, "growth_1990_2015")
plot_country_summary(country_energy_summary, "abs_growth")
plot_country_summary <- function(country_summary, plot_var){
country_summary %>%
ggplot(aes_(~country, as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette)
}
plot_country_summary(country_energy_summary, "growth_1990_2015")
plot_country_summary(country_energy_summary, "abs_growth")
country_summary %>%
group_by(country) %>%
arrange(abs_growth)
country_energy_summary %>%
group_by(country) %>%
arrange(abs_growth)
country_energy_summary %>%
filter(energy_source == "total_mtoe") %>%
arrange(abs_growth)
country_energy_summary %>%
filter(energy_source == "total_mtoe") %>%
arrange(abs_growth) %>%
select(country)
(country_energy_summary %>%
filter(energy_source == "total_mtoe") %>%
arrange(abs_growth) %>%
select(country))[[1]]
country_summary_levels <-
(country_energy_summary %>%
filter(energy_source == "total_mtoe") %>%
arrange(abs_growth) %>%
select(country))[[1]]
plot_country_summary <- function(country_summary, plot_var){
country_summary_levels <-
(country_summary %>%
filter(energy_source == "total_mtoe") %>%
arrange(abs_growth) %>%
select(country))[[1]]
country_summary <- country_summary %>%
mutate(country = factor(country, levels = country_summary_levels))
country_summary %>%
ggplot(aes_(~country, as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette)
}
plot_country_summary(country_energy_summary, "growth_1990_2015")
plot_country_summary <- function(country_summary, plot_var){
country_summary_levels <-
(country_summary %>%
filter(energy_source == "total_mtoe") %>%
arrange(abs_growth) %>%
select(country))[[1]]
country_summary <- country_summary %>% ungroup() %>%
mutate(country = factor(country, levels = country_summary_levels))
country_summary %>%
ggplot(aes_(~country, as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette)
}
plot_country_summary(country_energy_summary, "growth_1990_2015")
plot_country_summary <- function(country_summary, plot_var){
country_summary <- country_summary %>% ungroup() %>%
mutate(country = reorder(country, abs_growth))
country_summary %>%
ggplot(aes_(~country, as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette)
}
plot_country_summary(country_energy_summary, "growth_1990_2015")
install.packages("forcats")
plot_country_summary <- function(country_summary, plot_var){
country_summary %>%
ggplot(aes_(~forcats::fct_reorder(country, abs_growth),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette)
}
plot_country_summary(country_energy_summary, "growth_1990_2015")
plot_country_summary(country_energy_summary %>% ungroup, "growth_1990_2015")
plot_country_summary <- function(country_summary, plot_var){
country_summary %>%
ggplot(aes_(~forcats::fct_reorder2(country, abs_growth, energy_source),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette)
}
plot_country_summary(country_energy_summary %>% ungroup, "growth_1990_2015")
plot_country_summary <- function(country_summary, plot_var){
country_summary %>%
ggplot(aes_(~forcats::fct_reorder2(country, abs_growth, energy_source),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette)
}
plot_country_summary(country_energy_summary, "growth_1990_2015")
plot_country_summary <- function(country_summary, plot_var){
country_summary %>%
ggplot(aes_(~forcats::fct_reorder2(country, abs_growth),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette)
}
plot_country_summary(country_energy_summary, "growth_1990_2015")
plot_country_summary <- function(country_summary, plot_var){
country_summary %>%
ggplot(aes_(~forcats::fct_reorder(country, abs_growth),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette)
}
plot_country_summary(country_energy_summary, "growth_1990_2015")
plot_country_summary <- function(country_summary, plot_var){
country_summary %>%
filter(energy_source == "total_mtoe") %>%
ggplot(aes_(~forcats::fct_reorder(country, abs_growth),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette)
}
plot_country_summary(country_energy_summary, "growth_1990_2015")
plot_country_summary(country_energy_summary, "abs_growth")
plot_country_summary <- function(country_summary, plot_var){
country_summary %>%
# filter(energy_source == "total_mtoe") %>%
ggplot(aes_(~forcats::fct_reorder(country, abs_growth),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette)
}
plot_country_summary(country_energy_summary, "abs_growth")
plot_country_summary <- function(country_summary, plot_var){
country_summary %>%
# filter(energy_source == "total_mtoe") %>%
ggplot(aes_(~forcats::fct_reorder(country, abs_growth),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity",
position = "dodge") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette)
}
plot_country_summary(country_energy_summary, "abs_growth")
country_summary %>%
# filter(energy_source == "total_mtoe") %>%
ggplot(aes_(~forcats::fct_reorder(country, abs_growth),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette) +
facet_wrap(~energy_source, ncol = 1)
plot_country_summary <- function(country_summary, plot_var){
country_summary %>%
# filter(energy_source == "total_mtoe") %>%
ggplot(aes_(~forcats::fct_reorder(country, abs_growth),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette) +
facet_wrap(~energy_source, ncol = 1)
}
plot_country_summary(country_energy_summary, "abs_growth")
rm(country_summary_levels)
plot_country_summary <- function(country_summary, plot_var){
country_summary %>%
# filter(energy_source == "total_mtoe") %>%
ggplot(aes_(~forcats::fct_reorder(country, abs_growth),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette) +
facet_wrap(~energy_source, ncol = 1, scales = "free")
}
plot_country_summary(country_energy_summary, "abs_growth")
plot_country_summary(country_energy_summary %>%
top_n(10, abs_growth), "abs_growth")
country_energy_summary %>%
top_n(10, abs_growth)
country_energy_summary %>%
top_n(10)
plot_country_summary(country_energy_summary %>% ungroup() %>%
top_n(10, abs_growth), "abs_growth")
plot_country_summary(country_energy_summary %>% ungroup() %>%
top_n(-10, abs_growth), "abs_growth")
plot_country_summary(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe") %>%
top_n(-10, abs_growth), "abs_growth")
plot_country_summary(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe") %>%
top_n(-10, abs_growth),
"abs_growth")
plot_country_summary <- function(country_summary, plot_var){
country_summary %>%
ggplot(aes_(~forcats::fct_reorder(country, abs_growth),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette) +
facet_wrap(~energy_source, ncol = 1, scales = "free")
}
plot_country_summary(country_energy_summary, "growth_1990_2015")
plot_country_summary <- function(country_summary, plot_var, order_var){
country_summary %>%
ggplot(aes_(~forcats::fct_reorder(country, as.name(order_var)),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette) +
facet_wrap(~energy_source, ncol = 1, scales = "free")
}
plot_country_summary(country_energy_summary, "growth_1990_2015", "growth_1990_2015")
plot_country_summary(country_energy_summary, "growth_1990_2015", "growth_1990_2015")
plot_country_summary <- function(country_summary, plot_var, order_var){
country_summary %>%
ggplot(aes_(~forcats::fct_reorder(country, as.name(order_var)),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette) +
facet_wrap(~energy_source, ncol = 1, scales = "free")
}
plot_country_summary(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe") %>%
top_n(-10, abs_growth),
"abs_growth", "abs_growth")
plot_country_summary <- function(country_summary, plot_var){
country_summary %>%
ggplot(aes_(~forcats::fct_reorder(country, plot_var),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette) +
facet_wrap(~energy_source, ncol = 1, scales = "free")
}
plot_country_summary(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe") %>%
top_n(-10, abs_growth),
"abs_growth")
plot_country_summary <- function(country_summary, plot_var){
country_summary %>%
ggplot(aes_(~forcats::fct_reorder(country, as.name(plot_var)),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette) +
facet_wrap(~energy_source, ncol = 1, scales = "free")
}
plot_country_summary(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe") %>%
top_n(-10, abs_growth),
"abs_growth")
plot_country_summary <- function(country_summary, plot_var){
country_summary %>%
ggplot(aes_(~forcats::fct_reorder(country, abs_growth),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette) +
facet_wrap(~energy_source, ncol = 1, scales = "free")
}
plot_country_summary(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe") %>%
top_n(-10, abs_growth),
"abs_growth")
plot_country_summary <- function(country_summary, plot_var){
enq_plot_var <- enquo(plot_var)
country_summary %>%
ggplot(aes_(~forcats::fct_reorder(country, !!enq_plot_var),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette) +
facet_wrap(~energy_source, ncol = 1, scales = "free")
}
plot_country_summary(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe") %>%
top_n(-10, abs_growth),
"abs_growth")
plot_country_summary(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe") %>%
top_n(-10, abs_growth),
abs_growth)
plot_country_summary <- function(country_summary, plot_var){
enq_plot_var <- enquo(plot_var)
country_summary %>%
ggplot(aes_(~forcats::fct_reorder(country, !!enq_plot_var),
!!plot_var, fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette) +
facet_wrap(~energy_source, ncol = 1, scales = "free")
}
plot_country_summary(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe") %>%
top_n(-10, abs_growth),
abs_growth)
plot_country_summary <- function(country_summary, plot_var){
enq_plot_var <- enquo(plot_var)
country_summary %>%
ggplot(aes_(~forcats::fct_reorder(country, !!enq_plot_var),
!!enq_plot_var, fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette) +
facet_wrap(~energy_source, ncol = 1, scales = "free")
}
plot_country_summary(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe") %>%
top_n(-10, abs_growth),
abs_growth)
plot_country_summary <- function(country_summary, plot_var){
country_summary %>%
ggplot(aes_(~forcats::fct_reorder(country, abs_growth),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette) +
facet_wrap(~energy_source, ncol = 1, scales = "free")
}
plot_country_summary(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe") %>%
top_n(-10, abs_growth),
"abs_growth")
rm(plot_country_summary())
rm(plot_country_summary
)
plot_country_summary_growth <- function(country_summary, plot_var){
country_summary %>%
ggplot(aes_(~forcats::fct_reorder(country, growth_1990_2015),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette) +
facet_wrap(~energy_source, ncol = 1, scales = "free")
}
plot_country_summary_abs_growth(country_energy_summary, "growth_1990_2015")
plot_country_summary_abs_growth <- function(country_summary, plot_var){
country_summary %>%
ggplot(aes_(~forcats::fct_reorder(country, abs_growth),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette) +
facet_wrap(~energy_source, ncol = 1, scales = "free")
}
plot_country_summary_growth <- function(country_summary, plot_var){
country_summary %>%
ggplot(aes_(~forcats::fct_reorder(country, growth_1990_2015),
as.name(plot_var), fill = ~energy_source,
group = ~energy_source)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
scale_fill_manual(values = blorg::blog_palette) +
facet_wrap(~energy_source, ncol = 1, scales = "free")
}
plot_country_summary_growth(country_energy_summary, "growth_1990_2015")
plot_country_summary_growth(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe"),
"growth_1990_2015")
plot_country_summary_abs_growth(country_energy_summary %>% ungroup() %>%
filter(energy_source == "renewables_mtoe") %>%
top_n(-10, abs_growth),
"abs_growth")
plot_country_summary_abs_growth(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe") %>%
top_n(10, abs_growth),
"abs_growth")
plot_country_summary_abs_growth(country_energy_summary %>% ungroup() %>%
filter(energy_source == "renewables_mtoe") %>%
top_n(10, abs_growth),
"abs_growth")
plot_country_summary_growth(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe"),
"growth_1990_2015" %>%
top_n(10, abs_growth))
plot_country_summary_growth(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe"),
"growth_1990_2015") %>%
top_n(10, abs_growth))
plot_country_summary_growth(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe") %>%
top_n(10, abs_growth),
"growth_1990_2015")
plot_country_summary_growth(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe") %>%
top_n(10, growth_1990_2015),
"growth_1990_2015")
plot_country_summary_abs_growth(country_energy_summary %>% ungroup() %>%
filter(energy_source == "renewables_mtoe") %>%
top_n(10, abs_growth),
"abs_growth")
plot_country_summary_abs_growth(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe") %>%
top_n(10, abs_growth),
"abs_growth")
readxl::read_xls("./data/raw/tps_data.xls") %>% View()
readxl::read_xls("./data/raw/tps_primary.xls") %>% View()
readxl::read_xls("./data/raw/tps_primary_energy.xls") %>% View()
readxl::read_xls("./data/raw/tps_3.xls") %>% View()
plot_country_summary_abs_growth(country_energy_summary %>% ungroup() %>%
plot_country_summary_abs_growth(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe") %>%
top_n(10, abs_growth),
"abs_growth")
plot_country_summary_abs_growth(country_energy_summary %>% ungroup() %>%
filter(energy_source == "renewables_mtoe") %>%
top_n(10, abs_growth),
"abs_growth")
plot_country_summary_growth(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe") %>%
top_n(10, growth_1990_2015),
"growth_1990_2015")
plot_country_summary_abs_growth(country_energy_summary %>% ungroup() %>%
filter(energy_source == "renewables_mtoe") %>%
top_n(10, abs_growth),
"abs_growth")
plot_country_summary_abs_growth(country_energy_summary %>% ungroup() %>%
filter(energy_source == "total_mtoe") %>%
top_n(10, abs_growth),
"abs_growth")
