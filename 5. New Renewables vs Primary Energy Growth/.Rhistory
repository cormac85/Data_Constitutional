rename(country_iso3 = location, year = time,
million_tonnes_equivalent = value) %>%
select(-measure)  %>%
mutate(million_tonnes_equivalent = million_tonnes_equivalent / 1000)
renewable_energy_clean<-
renewable_energy %>%
filter(year %in% 1990:2015) %>%
left_join(country_codes, by = c("country_iso3" = "CODE")) %>%
select(-X__1, -X__2) %>%
rename(country = Country)
install.packages("devtools")
devtools::install_github("cormac85/Data_Constitutional/Utilities/blorg")
blorg::blog_theme
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
if(!interactive()){
knitr::opts_knit$set(root.dir = "..")
}
# Chunk 2: libraries
library(tidyverse)
# Chunk 3: functions
growth <- function(x) {(x / lag(x)) - 1}
abs_growth <- function(x) {x - lag(x)}
clean_names <- function(x) {tolower(stringr::str_replace(x, " ", "_"))}
# Chunk 4: import & clean 1
primary_energy <-
readr::read_csv("./data/raw/primary_energy.csv") %>%
rename_all(clean_names) %>%
select(-flag_codes, -frequency, -subject, -indicator) %>%
filter(measure == "MLN_TOE",
!(location %in% c("G20", "EU28", "OECD", "OEU", "WLD"))) %>%
rename(country_iso3 = location, year = time,
million_tonnes_equivalent = value) %>%
select(-measure)
country_codes <- readxl::read_excel("./data/raw/world_country_codes.xls")
primary_energy_clean <-
primary_energy %>%
filter(year %in% 1990:2015) %>%
left_join(country_codes, by = c("country_iso3" = "CODE")) %>%
select(-X__1, -X__2) %>%
rename(country = Country)
# Chunk 5: import & clean 2
renewable_energy <-
readr::read_csv("./data/raw/renewable_primary_energy.csv") %>%
rename_all(clean_names)
renewable_energy %>% select_if(is.character) %>% map(unique)
# Chunk 6: import & clean 3
renewable_energy <-
renewable_energy %>%
select(-flag_codes, -frequency, -subject, -indicator) %>%
filter(measure == "KTOE",
!(location %in% c("G20", "EU28", "OECD", "OEU", "WLD"))) %>%
rename(country_iso3 = location, year = time,
million_tonnes_equivalent = value) %>%
select(-measure)  %>%
mutate(million_tonnes_equivalent = million_tonnes_equivalent / 1000)
renewable_energy_clean<-
renewable_energy %>%
filter(year %in% 1990:2015) %>%
left_join(country_codes, by = c("country_iso3" = "CODE")) %>%
select(-X__1, -X__2) %>%
rename(country = Country)
# Chunk 7
renewable_energy_clean %>% select(country) %>% is.na() %>%
table() %>% as_tibble() %>%  knitr::kable(caption = "Is country NA?")
# Chunk 8: exploration 1
primary_energy %>%
ggplot(aes(year, million_tonnes_equivalent, fill = country_iso3)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
theme(legend.position = "none")
# Chunk 9: exploration 2
primary_energy_clean %>%
filter(stringr::str_detect(country, "China|United States|India")) %>%
ggplot(aes(year, million_tonnes_equivalent, fill = country)) +
geom_bar(stat = "identity") +
blorg::blog_theme
is.na(primary_energy$million_tonnes_equivalent) %>% table() %>%
knitr::kable(caption = "Missing Data From Entire Dataset")
is.na(primary_energy_clean$million_tonnes_equivalent) %>% table() %>%
knitr::kable(caption = "Missing Data From 1990 Onwards")
primary_energy_clean %>%
filter(is.na(million_tonnes_equivalent)) %>% select(country) %>%
unique() %>% knitr::kable(caption = "Countries with missing data between 1990 - 2015")
# Chunk 10: exploration 3
renewable_energy %>%
ggplot(aes(year, million_tonnes_equivalent, fill = country_iso3)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
theme(legend.position = "none")
is.na(renewable_energy$million_tonnes_equivalent) %>% table() %>%
knitr::kable(caption = "Missing Data From Entire Dataset")
is.na(renewable_energy_clean$million_tonnes_equivalent) %>% table() %>%
knitr::kable(caption = "Missing Data From 1990 Onwards")
renewable_energy_clean %>%
filter(is.na(million_tonnes_equivalent)) %>% select(country) %>%
unique() %>% knitr::kable(caption = "Countries with missing data between 1990 - 2015")
# Chunk 11: enrichment
primary_energy_enriched <-
primary_energy_clean %>%
rename(total_mtoe = million_tonnes_equivalent) %>%
left_join((renewable_energy_clean %>%
select(year, country, million_tonnes_equivalent)),
by = c("country", "year")) %>%
rename(renewables_mtoe = million_tonnes_equivalent) %>%
select(-country_iso3) %>%
gather(energy_source, mtoe, total_mtoe, renewables_mtoe)
# Anything with "mtoe" in title will have growth calculated.
# Adding more primary energy sources to dataset should "just work"
primary_energy_enriched <-
primary_energy_enriched %>%
group_by(country, energy_source) %>%
mutate_at(vars(contains("mtoe")),
funs(growth = growth, abs_growth = abs_growth)) %>%
ungroup()
saveRDS(primary_energy_enriched,
"./data/processed/primary_energy_enriched.rds")
# Chunk 12: explore enriched
sum_growth <- function(x){ sum(growth(x), na.rm = TRUE) }
sum_abs_growth <- function(x){ sum(abs_growth(x), na.rm = TRUE) }
my_sum <- function(x){ sum(x, na.rm = TRUE)}
yearly_energy_summary <-
primary_energy_enriched %>%
filter(year != 1990) %>%
group_by(year, energy_source) %>%
summarise_at(vars(contains("mtoe")),
funs(growth = sum_growth, abs_growth = sum_abs_growth,
total_mtoe = my_sum))
primary_energy_enriched %>%
#  filter(year != 1990) %>%
group_by(year, energy_source) %>%
summarise_at(vars(contains("mtoe")),
funs(growth = sum(growth, na.rm = TRUE),
abs_growth = sum(abs_growth, na.rm = TRUE),
total_mtoe = my_sum)) %>% View()
primary_energy_enriched %>% filter(energy_source == "renewables_mtoe",
year %in% 1991:1992)
primary_energy_clean %>% filter(year %in% 1991:1992)
primary_energy %>% filter(year %in% 1991:1992)
yearly_energy_summary %>% glimpse()
# Chunk 13
# Chunk 14
# Chunk 15
yearly_energy_summary
yearly_energy_summary %>% glimpse()
primary_energy_enriched %>% filter(energy_source == "renewables_mtoe",
year %in% 1991:1992)
primary_energy_enriched %>% filter(energy_source == "renewables_mtoe",
year %in% 1991:1992) %>% View()
primary_energy
View(primary_energy)
country_codes
View(country_codes)
readxl::read_excel("./data/raw/world_country_codes.xls") %>%
select(-X__1, -X__2)
country_codes <- readxl::read_excel("./data/raw/world_country_codes.xls") %>%
select(-X__1, -X__2)
View(country_codes)
primary_energy %>%
filter(year %in% 1990:2015) %>%
left_join(country_codes, by = c("country_iso3" = "CODE")) %>%
rename(country = Country)
primary_energy %>%
filter(year %in% 1990:2015) %>%
left_join(country_codes, by = c("country_iso3" = "CODE")) %>%
rename(country = Country) %>% View()
readr::read_csv("./data/raw/renewable_primary_energy.csv") %>%
rename_all(clean_names)
renewable_energy %>%
select(-flag_codes, -frequency, -subject, -indicator) %>%
filter(measure == "KTOE",
!(location %in% c("G20", "EU28", "OECD", "OEU", "WLD"))) %>%
rename(country_iso3 = location, year = time,
million_tonnes_equivalent = value) %>%
select(-measure)  %>%
mutate(million_tonnes_equivalent = million_tonnes_equivalent / 1000)
renewable_energy
renewable_energy <-
readr::read_csv("./data/raw/renewable_primary_energy.csv") %>%
rename_all(clean_names)
renewable_energy %>%
select(-flag_codes, -frequency, -subject, -indicator) %>%
filter(measure == "KTOE",
!(location %in% c("G20", "EU28", "OECD", "OEU", "WLD"))) %>%
rename(country_iso3 = location, year = time,
million_tonnes_equivalent = value) %>%
select(-measure)  %>%
mutate(million_tonnes_equivalent = million_tonnes_equivalent / 1000)
renewable_energy <-
renewable_energy %>%
select(-flag_codes, -frequency, -subject, -indicator) %>%
filter(measure == "KTOE",
!(location %in% c("G20", "EU28", "OECD", "OEU", "WLD"))) %>%
rename(country_iso3 = location, year = time,
million_tonnes_equivalent = value) %>%
select(-measure)  %>%
mutate(million_tonnes_equivalent = million_tonnes_equivalent / 1000)
renewable_energy %>%
filter(year %in% 1990:2015) %>%
left_join(country_codes, by = c("country_iso3" = "CODE")) %>%
rename(country = Country)
renewable_energy_clean<-
renewable_energy %>%
filter(year %in% 1990:2015) %>%
left_join(country_codes, by = c("country_iso3" = "CODE")) %>%
rename(country = Country)
View(renewable_energy_clean)
renewable_energy_clean %>% select(country) %>% is.na() %>%
table() %>% as_tibble() %>%  knitr::kable(caption = "Is country NA?")
renewable_energy_clean
renewable_energy_clean %>% select(country) %>% is.na() %>%
table()
renewable_energy_clean %>% select(country)
renewable_energy_clean %>% select(country)
renewable_energy_clean %>% select(country) %>% table
renewable_energy_clean %>% select(country) %>% is.na()
readr::read_csv("https://github.com/datasets/country-codes/blob/master/data/country-codes.csv")
readr::read_csv("https://raw.githubusercontent.com/lukes/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv") %>%
readr::read_csv("https://raw.githubusercontent.com/lukes/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv")
readr::read_csv("https://raw.githubusercontent.com/lukes/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv") %>% View()
readr::read_csv("https://raw.githubusercontent.com/lukes/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv") %>%
select(name, alpha-3)
country_codes <- readr::read_csv("https://raw.githubusercontent.com/lukes/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv") %>%
select(name, `alpha-3`)
country_codes <- readr::read_csv("https://raw.githubusercontent.com/lukes/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv") %>%
rename(alpha_3 = `alpha-3`) %>%
select(name, `alpha_3`)
renewable_energy
primary_energy
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
if(!interactive()){
knitr::opts_knit$set(root.dir = "..")
}
# Chunk 2: libraries
library(tidyverse)
# Chunk 3: functions
growth <- function(x) {(x / lag(x)) - 1}
abs_growth <- function(x) {x - lag(x)}
clean_names <- function(x) {tolower(stringr::str_replace(x, " ", "_"))}
primary_energy <-
readr::read_csv("./data/raw/primary_energy.csv") %>%
rename_all(clean_names) %>%
select(-flag_codes, -frequency, -subject, -indicator) %>%
filter(measure == "MLN_TOE",
!(location %in% c("G20", "EU28", "OECD", "OEU", "WLD"))) %>%
rename(country_iso3 = location, year = time,
million_tonnes_equivalent = value) %>%
select(-measure)
country_codes <- readr::read_csv("https://raw.githubusercontent.com/lukes/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv") %>%
rename(alpha_3 = `alpha-3`) %>%
select(name, alpha_3)
primary_energy
country_codes
primary_energy %>%
filter(year %in% 1990:2015) %>%
left_join(country_codes, by = c("country_iso3" = "alpha_3")) %>%
rename(country = name)
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE)
if(!interactive()){
knitr::opts_knit$set(root.dir = "..")
}
# Chunk 2: libraries
library(tidyverse)
# Chunk 3: functions
growth <- function(x) {(x / lag(x)) - 1}
abs_growth <- function(x) {x - lag(x)}
clean_names <- function(x) {tolower(stringr::str_replace(x, " ", "_"))}
# Chunk 4: import & clean 1
primary_energy <-
readr::read_csv("./data/raw/primary_energy.csv") %>%
rename_all(clean_names) %>%
select(-flag_codes, -frequency, -subject, -indicator) %>%
filter(measure == "MLN_TOE",
!(location %in% c("G20", "EU28", "OECD", "OEU", "WLD"))) %>%
rename(country_iso3 = location, year = time,
million_tonnes_equivalent = value) %>%
select(-measure)
# Country codes retrieved from: http://www.oecd.org/migration/mig/34107835.xls
country_codes <- readr::read_csv("https://raw.githubusercontent.com/lukes/ISO-3166-Countries-with-Regional-Codes/master/all/all.csv") %>%
rename(alpha_3 = `alpha-3`) %>%
select(name, alpha_3)
primary_energy_clean <-
primary_energy %>%
filter(year %in% 1990:2015) %>%
left_join(country_codes, by = c("country_iso3" = "alpha_3")) %>%
rename(country = name)
# Chunk 5: import & clean 2
renewable_energy <-
readr::read_csv("./data/raw/renewable_primary_energy.csv") %>%
rename_all(clean_names)
renewable_energy %>% select_if(is.character) %>% map(unique)
# Chunk 6: import & clean 3
renewable_energy <-
renewable_energy %>%
select(-flag_codes, -frequency, -subject, -indicator) %>%
filter(measure == "KTOE",
!(location %in% c("G20", "EU28", "OECD", "OEU", "WLD"))) %>%
rename(country_iso3 = location, year = time,
million_tonnes_equivalent = value) %>%
select(-measure)  %>%
mutate(million_tonnes_equivalent = million_tonnes_equivalent / 1000)
renewable_energy_clean<-
renewable_energy %>%
filter(year %in% 1990:2015) %>%
left_join(country_codes, by = c("country_iso3" = "alpha_3")) %>%
rename(country = name)
# Chunk 7
renewable_energy_clean %>% select(country) %>% is.na() %>%
table() %>% as_tibble() %>%  knitr::kable(caption = "Is country NA?")
# Chunk 8: exploration 1
primary_energy %>%
ggplot(aes(year, million_tonnes_equivalent, fill = country_iso3)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
theme(legend.position = "none")
# Chunk 9: exploration 2
primary_energy_clean %>%
filter(stringr::str_detect(country, "China|United States|India")) %>%
ggplot(aes(year, million_tonnes_equivalent, fill = country)) +
geom_bar(stat = "identity") +
blorg::blog_theme
is.na(primary_energy$million_tonnes_equivalent) %>% table() %>%
knitr::kable(caption = "Missing Data From Entire Dataset")
is.na(primary_energy_clean$million_tonnes_equivalent) %>% table() %>%
knitr::kable(caption = "Missing Data From 1990 Onwards")
primary_energy_clean %>%
filter(is.na(million_tonnes_equivalent)) %>% select(country) %>%
unique() %>% knitr::kable(caption = "Countries with missing data between 1990 - 2015")
# Chunk 10: exploration 3
renewable_energy %>%
ggplot(aes(year, million_tonnes_equivalent, fill = country_iso3)) +
geom_bar(stat = "identity") +
blorg::blog_theme +
theme(legend.position = "none")
is.na(renewable_energy$million_tonnes_equivalent) %>% table() %>%
knitr::kable(caption = "Missing Data From Entire Dataset")
is.na(renewable_energy_clean$million_tonnes_equivalent) %>% table() %>%
knitr::kable(caption = "Missing Data From 1990 Onwards")
renewable_energy_clean %>%
filter(is.na(million_tonnes_equivalent)) %>% select(country) %>%
unique() %>% knitr::kable(caption = "Countries with missing data between 1990 - 2015")
# Chunk 11: enrichment
primary_energy_enriched <-
primary_energy_clean %>%
rename(total_mtoe = million_tonnes_equivalent) %>%
left_join((renewable_energy_clean %>%
select(year, country, million_tonnes_equivalent)),
by = c("country", "year")) %>%
rename(renewables_mtoe = million_tonnes_equivalent) %>%
select(-country_iso3) %>%
gather(energy_source, mtoe, total_mtoe, renewables_mtoe)
# Anything with "mtoe" in title will have growth calculated.
# Adding more primary energy sources to dataset should "just work"
primary_energy_enriched <-
primary_energy_enriched %>%
group_by(country, energy_source) %>%
mutate_at(vars(contains("mtoe")),
funs(growth = growth, abs_growth = abs_growth)) %>%
ungroup()
saveRDS(primary_energy_enriched,
"./data/processed/primary_energy_enriched.rds")
sum_growth <- function(x){ sum(growth(x), na.rm = TRUE) }
sum_abs_growth <- function(x){ sum(abs_growth(x), na.rm = TRUE) }
my_sum <- function(x){ sum(x, na.rm = TRUE)}
yearly_energy_summary <-
primary_energy_enriched %>%
filter(year != 1990) %>%
group_by(year, energy_source) %>%
summarise_at(vars(contains("mtoe")),
funs(growth = sum_growth, abs_growth = sum_abs_growth,
total_mtoe = my_sum))
primary_energy_enriched %>%
#  filter(year != 1990) %>%
group_by(year, energy_source) %>%
summarise_at(vars(contains("mtoe")),
funs(growth = sum(growth, na.rm = TRUE),
abs_growth = sum(abs_growth, na.rm = TRUE),
total_mtoe = my_sum))
primary_energy_enriched %>% filter(energy_source == "renewables_mtoe",
year %in% 1991:1992) %>% View()
primary_energy_clean %>% filter(year %in% 1991:1992)
primary_energy %>% filter(year %in% 1991:1992)
yearly_energy_summary %>% glimpse()
View(yearly_energy_summary)
primary_energy_enriched %>%
filter(year != 1990) %>%
group_by(year, energy_source) %>%
summarise_at(vars(contains("mtoe")),
funs(growth = sum_growth, abs_growth = sum_abs_growth,
total_mtoe = my_sum))
primary_energy_enriched
View(primary_energy_enriched)
primary_energy_enriched %>%
filter(year != 1990)
primary_energy_enriched %>%
filter(year != 1990) %>%
group_by(year, energy_source)
primary_energy_enriched %>%
filter(year != 1990) %>%
group_by(year, energy_source) %>%
summarise_at(vars(contains("mtoe")),
funs(growth = sum_growth, abs_growth = sum_abs_growth,
total_mtoe = my_sum))
View(growth)
yearly_energy_summary <-
primary_energy_enriched %>%
filter(year != 1990) %>%
group_by(year, energy_source) %>%
summarise_at(vars(contains("mtoe")),
funs(abs_growth = sum_abs_growth,
total_mtoe = my_sum))
yearly_energy_summary
primary_energy_enriched %>%
#  filter(year != 1990) %>%
group_by(year, energy_source) %>%
summarise_at(vars(contains("mtoe")),
funs(growth = sum(growth, na.rm = TRUE),
abs_growth = sum(abs_growth, na.rm = TRUE),
total_mtoe = my_sum))
primary_energy_enriched %>%
filter(year != 1990) %>%
group_by(year, energy_source) %>%
summarise_at(vars(contains("mtoe")),
funs(growth = sum(growth, na.rm = TRUE),
abs_growth = sum(abs_growth, na.rm = TRUE),
total_mtoe = my_sum))
yearly_energy_summary <-
primary_energy_enriched %>%
filter(year != 1990) %>%
group_by(year, energy_source) %>%
summarise_at(vars(contains("mtoe")),
funs(growth = sum(growth, na.rm = TRUE),
abs_growth = sum(abs_growth, na.rm = TRUE),
total_mtoe = my_sum))
yearly_energy_summary %>% glimpse()
yearly_energy_summary
yearly_energy_summary %>%
ggplot(aes(year, total_mtoe, group = energy_source,
colour = energy_source)) %>%
geom_line()
yearly_energy_summary %>%
ggplot(aes(year, total_mtoe, group = energy_source,
colour = energy_source)) +
geom_line()
yearly_energy_summary %>%
ggplot(aes(year, total_mtoe, group = energy_source,
colour = energy_source)) +
geom_line() +
blorg::blog_theme
yearly_energy_summary %>%
ggplot(aes(year, total_mtoe, group = energy_source,
colour = energy_source)) +
geom_line() +
blorg::blog_theme +
scale_color_manual(values = blorg::blog_palette)
yearly_energy_summary %>%
ggplot(aes(year, total_mtoe, group = energy_source,
colour = energy_source)) +
geom_line(size = 1.2) +
blorg::blog_theme +
scale_color_manual(values = blorg::blog_palette)
yearly_energy_summary
yearly_energy_summary %>%
ggplot(aes(year, growth, group = energy_source,
colour = energy_source)) +
geom_line(size = 1.2) +
blorg::blog_theme +
scale_color_manual(values = blorg::blog_palette)
yearly_energy_summary %>%
ggplot(aes(year, abs_growth, group = energy_source,
colour = energy_source)) +
geom_line(size = 1.2) +
blorg::blog_theme +
scale_color_manual(values = blorg::blog_palette)
primary_energy_enriched
primary_energy_enriched %>% filter(year == 2015)
primary_energy_enriched %>% filter(year == 2015) %>% spread(energy, mtoe)
primary_energy_enriched %>% filter(year == 2015) %>% spread(energy_source, mtoe)
primary_energy_enriched %>% filter(year == 2015) %>% spread(energy_source, mtoe, -abs_growth)
primary_energy_enriched %>% filter(year == 2015) %>% select(-growth, -abs_growth()) %>%  spread(energy_source, mtoe)
primary_energy_enriched %>% filter(year == 2015) %>% select(-growth, -abs_growth) %>%  spread(energy_source, mtoe)
primary_energy_enriched %>% filter(year == 2015) %>% select(-growth, -abs_growth) %>%  spread(energy_source, mtoe) %>% mutate(renewables_percentage = (100 * renewables_mtoe) / total_mtoe)
filter(year == 2015) %>%
select(-growth, -abs_growth) %>%
spread(energy_source, mtoe) %>%
mutate(renewables_percentage = (100 * renewables_mtoe) / total_mtoe)
primary_energy_enriched %>%
filter(year == 2015) %>%
select(-growth, -abs_growth) %>%
spread(energy_source, mtoe) %>%
mutate(renewables_percentage = (100 * renewables_mtoe) / total_mtoe)
primary_energy_enriched %>%
filter(year == 2015) %>%
select(-growth, -abs_growth) %>%
spread(energy_source, mtoe) %>%
mutate(renewables_percentage = (100 * renewables_mtoe) / total_mtoe) %>%
arrange(renewables_percentage)
primary_energy_enriched %>%
filter(year == 2015) %>%
select(-growth, -abs_growth) %>%
spread(energy_source, mtoe) %>%
mutate(renewables_percentage = (100 * renewables_mtoe) / total_mtoe) %>%
arrange(desc(renewables_percentage))
primary_energy_enriched %>%
filter(year == 2015) %>%
select(-growth, -abs_growth) %>%
spread(energy_source, mtoe) %>%
mutate(renewables_percentage = (100 * renewables_mtoe) / total_mtoe) %>%
arrange(desc(renewables_percentage)) %>%
top_n(10, renewables_percentage)
