emmigration_raw <- readr::read_tsv("./data/tps00177_emmigration.tsv")
immigration_raw <- readr::read_tsv("./data/tps00176_immigration.tsv")
View(immigration_raw)
?stringr::str_tr
?stringr::str_extract
shopping_list <- c("apples x4", "bag of flour", "bag of sugar", "milk x2")
str_extract(shopping_list, "\\d")
stringr::str_extract(shopping_list, "\\d")
stringr::str_extract(c("14103 bp", "18570 p", "26615 p","25223 p", 21241), "\\d")
stringr::str_extract(c("14103 bp", "18570 p", "26615 p","25223 p", 21241), "[0-9]+")
library(tidyverse)
immigration_raw %>% mutate_all(.funs = stringr::str_extract("[0-9]+"))
immigration_raw %>% mutate_all(.funs = stringr::str_extract(pattern = "[0-9]+"))
immigration_raw %>% mutate_all(.funs = stringr::str_extract,
pattern = "[0-9]+"))
immigration_raw %>% mutate_all(.funs = stringr::str_extract,
pattern = "[0-9]+")
immigration_raw %>% mutate_at(.predicate = num_range(2000:2100),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
immigration_raw %>% mutate_at(.predicate = num_range(2000:2100),
.funs = stringr::str_extract,
pattern = "[0-9]+")
immigration_raw %>% mutate_at(.predicate = vars(num_range(2000:2100)),
.funs = stringr::str_extract,
pattern = "[0-9]+")
immigration_raw %>% mutate_at(.vars = num_range(2000:2100),
.funs = stringr::str_extract,
pattern = "[0-9]+")
immigration_raw %>% mutate_at(.vars = num_range(2000:2100),
.funs = stringr::str_extract,
pattern = "[0-9]+")
immigration_raw %>% mutate_at(.vars = num_range(range = 2000:2100),
.funs = stringr::str_extract,
pattern = "[0-9]+")
immigration_raw %>% mutate_at(.vars = num_range(prefix = "",
range = 2000:2100),
.funs = stringr::str_extract,
pattern = "[0-9]+")
immigration_raw %>% mutate_at(.vars = starts_with(2),
.funs = stringr::str_extract,
pattern = "[0-9]+")
immigration_raw %>% mutate_at(.vars = starts_with("2"),
.funs = stringr::str_extract,
pattern = "[0-9]+")
immigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+")
shopping_list <- c("apples x4", "bag of flour", "bag of sugar", "milk x2")
stringr::str_extract(shopping_list, "\\d")
stringr::str_extract(c("14103 bp", "18570 p", "26615 p","25223 p", 21241), "[0-9]+")
stringr::str_extract(shopping_list, "[a-z]+")
stringr::str_extract(shopping_list, "[a-z]{1,4}")
stringr::str_extract(shopping_list, "\\b[a-z]{1,4}\\b")
rm(shopping_list)
immigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename(1, "variable")
colnames(immigration_raw[,1])
immigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename(colnames(immigration_raw[,1]), "variable")
immigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename_("variable" = colnames(immigration_raw[,1]))
colnames(immigration_raw[,1])
immigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename_("variable" = colnames(immigration_raw[,1]))
immigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename(variable = colnames(immigration_raw[,1]))
immigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename(variable = "citizen,agedef,age,unit,sex,geo\\time")
immigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename(variable = "citizen,agedef,age,unit,sex,geo\\time") %>%
separate(variable, sep = ",")
immigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename(variable = "citizen,agedef,age,unit,sex,geo\\time") %>%
separate(variable, into = c("a", "b", "c", "d", "e", "country_code"),
sep = ",")
immigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename(variable = "citizen,agedef,age,unit,sex,geo\\time") %>%
separate(variable, into = c("a", "b", "c", "d", "e", "country_code"),
sep = ",") %>%
select(-a:e)
immigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename(variable = "citizen,agedef,age,unit,sex,geo\\time") %>%
separate(variable, into = c("a", "b", "c", "d", "e", "country_code"),
sep = ",") %>%
select(-1:5)
immigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename(variable = "citizen,agedef,age,unit,sex,geo\\time") %>%
separate(variable, into = c("a", "b", "c", "d", "e", "country_code"),
sep = ",") %>%
select(-matches("[a-e]"))
immigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename(variable = "citizen,agedef,age,unit,sex,geo\\time") %>%
separate(variable, into = c("a", "b", "c", "d", "e", "country_code"),
sep = ",") %>%
select(-a, -b, -c, -d, -e)
immigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename(variable = "citizen,agedef,age,unit,sex,geo\\time") %>%
separate(variable, into = c("a", "b", "c", "d", "e", "country_code"),
sep = ",") %>%
select(country_code:2016)
immigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename(variable = "citizen,agedef,age,unit,sex,geo\\time") %>%
separate(variable, into = c("a", "b", "c", "d", "e", "country_code"),
sep = ",") %>%
select(-a, -b, -c, -d, -e) %>%
gather(key = year, value = immigrants)
immigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename(variable = "citizen,agedef,age,unit,sex,geo\\time") %>%
separate(variable, into = c("a", "b", "c", "d", "e", "country_code"),
sep = ",") %>%
select(-a, -b, -c, -d, -e) %>%
gather(key = year, value = immigrants, 2005:2016)
immigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename(variable = "citizen,agedef,age,unit,sex,geo\\time") %>%
separate(variable, into = c("a", "b", "c", "d", "e", "country_code"),
sep = ",") %>%
select(-a, -b, -c, -d, -e) %>%
gather(key = year, value = immigrants, `2005`:`2016`)
imm_clean <-
immigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename(variable = "citizen,agedef,age,unit,sex,geo\\time") %>%
separate(variable, into = c("a", "b", "c", "d", "e", "country_code"),
sep = ",") %>%
select(-a, -b, -c, -d, -e) %>%
gather(key = year, value = immigrants, `2005`:`2016`)
emm_clean <-
emmigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename(variable = "citizen,agedef,age,unit,sex,geo\\time") %>%
separate(variable, into = c("a", "b", "c", "d", "e", "country_code"),
sep = ",") %>%
select(-a, -b, -c, -d, -e) %>%
gather(key = year, value = immigrants, `2005`:`2016`)
glimpse(imm_clean)
glimpse(imm_clean) %>% knitr::kable()
glimpse(imm_clean)
summary(imm_clean)
imm_clean <-
immigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename(variable = "citizen,agedef,age,unit,sex,geo\\time") %>%
separate(variable, into = c("a", "b", "c", "d", "e", "country_code"),
sep = ",") %>%
select(-a, -b, -c, -d, -e) %>%
gather(key = year, value = immigrants, `2005`:`2016`) %>%
mutate(immigrants = as.numeric(immigrants))
emm_clean <-
emmigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename(variable = "citizen,agedef,age,unit,sex,geo\\time") %>%
separate(variable, into = c("a", "b", "c", "d", "e", "country_code"),
sep = ",") %>%
select(-a, -b, -c, -d, -e) %>%
gather(key = year, value = emmigrants, `2005`:`2016`) %>%
mutate(emmigrants = as.numeric(emmigrants))
View(emm_clean)
View(imm_clean)
summary(imm_clean)
imm_clean %>%
group_by(year) %>%
summarise(median_immigrants = median(immigrants))
imm_clean %>%
group_by(year) %>%
summarise(median_immigrants = median(immigrants, na.rm = TRUE))
imm_clean %>%
group_by(year) %>%
summarise(mean_immigrants = mean(immigrants, na.rm = TRUE),
sum_immigrants = sum(immigrants, na.rm = TRUE))
imm_emm_clean <-
imm_clean %>%
left_join(emm_clean, by = c(country_code, year))
imm_clean %>%
left_join(emm_clean, by = c("country_code", "year"))
emm_clean <-
emmigration_raw %>% mutate_at(.vars = vars(starts_with("2")),
.funs = stringr::str_extract,
pattern = "[0-9]+") %>%
rename(variable = "citizen,agedef,age,unit,sex,geo\\time") %>%
separate(variable, into = c("a", "b", "c", "d", "e", "country_code"),
sep = ",") %>%
select(-a, -b, -c, -d, -e) %>%
gather(key = year, value = emmigrants, `2005`:`2016`) %>%
mutate(emmigrants = as.numeric(emmigrants))
imm_emm_clean <-
imm_clean %>%
left_join(emm_clean, by = c("country_code", "year"))
imm_emm_clean <-
imm_clean %>%
left_join(emm_clean, by = c("country_code", "year")) %>%
net_migration = immigrants - emmigrants
imm_emm_clean <-
imm_clean %>%
left_join(emm_clean, by = c("country_code", "year")) %>%
mutate(net_migration = immigrants - emmigrants)
imm_emm_clean <-
imm_clean %>%
left_join(emm_clean, by = c("country_code", "year")) %>%
mutate(net_migration = immigrants - emmigrants)
imm_clean %>%
group_by(year) %>%
summarise_if(is.numeric,
mean_immigrants = mean(immigrants, na.rm = TRUE),
sum_immigrants = sum(immigrants, na.rm = TRUE))
imm_clean %>%
group_by(year) %>%
summarise_if(is.numeric, sum, na.rm = TRUE)
imm_emm_clean %>%
group_by(year) %>%
summarise_if(is.numeric, sum, na.rm = TRUE)
